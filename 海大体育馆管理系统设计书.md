# 权限管理设计



## 设计说明

本系统基于角色划分用户权限，一个用户对应一个角色。一共设计有三个角色，分别是系统管理员、体育馆管理员、学生。这三个角色并不是层级关系，而是有部分交集。



## 角色划分



### 系统管理员

#### 角色描述

在现实生活中，系统管理员一般是学校信息管理系统的老师，不具体负责体育相关事务以及器材、场地和赛事的使用申请与审核

#### 拥有权限

分配系统中用户的权限

### 体育馆管理员

#### 角色描述

一般指体育专业相关的老师

#### 拥有权限

负责器材和场地的维护与租用审核、赛事的创建与审核等

### 学生

#### 角色描述

主要指高校学生、普通教师也可以使用邮箱注册和学生拥有相同的权限

#### 拥有权限

器材和场地的租用，赛事的创建等



# 功能模块设计

## 用户模块

### 单个用户状态

#### 正常

表示用户当前可登录、可租用器材、场地及创建赛事

#### 未赔偿

表示用户当前可登录，但因为为赔偿器材损失、无法租用器材、场地及创建赛事

#### 已删除

表示用户当前不可登录及后续操作，管理员将其恢复正常状态



### 用户注册

#### 系统管理员注册

在数据库服务器上通过命令行直接写入数据库

管理员注册需要用户名、姓名、密码、邮箱

> 示例：用户名root-1（规范，待定）、姓名（实名）、密码（规范，待定）、邮箱（待定）

#### 体育馆管理员注册

由系统管理员统一（增删改查）

体育馆管理员注册需要用户名、姓名、密码、邮箱

> 示例：用户名root-1（规范，待定）、姓名（实名）、密码（规范，待定）、邮箱（待定）

#### 学生注册

自己注册，系统管理员审核（可批量通过）

学生注册需要（用户信息表）：学号、姓名、密码、邮箱

> 示例：学号（规范，待定）、姓名（实名）、密码（规范，待定）、邮箱（待定）
>
> 后端向前端发送“待审核用户”的名单（分页传输，JSON）

### 用户登录

统一使用邮箱+密码登录。

找回密码：邮箱验证码

### 用户找回密码

根据账号权限，前端自动展示对应菜单界面

### 用户查询

仅系统管理员可见

## 器材管理模块

### 单个器材状态

#### 可租用

表示器材**长期**可查询（学生和体育馆管理员）、可租用

#### 维护

表示器材当前正在维护，不可被查询（学生不可以，体育馆管理员可以）、租用

#### 报废

表示器材已报废，不可查询、租用

> 此处舍弃“使用中”的状态是由于该状态需要频繁变动，不符合长期保存的要求。“可租用”指的是器材可以被**长期**被租用，而不是临时可以被租用，且当器材被租用后不处于“可租用”的状态
>
> 当器材被租出去的时候，器材的状态锁定，不可变更，即“器材查询模块”中，若体育馆管理员需要变更器材状态和修改租金，不允许。





### 新增器材

权限：体育馆管理员

需要数据：器材类型、品牌名、采购价、租金；默认单次添加一个器材，可批量添加同款器材。

添加完毕后，会组成一个添加集合，前端发送该集合，后端分析该集合，根据器材自动赋予对应的器材编号

前期数据库设计，待定

> 器材表（单独一个器材对应一个编号）：器材编号（pk）、种类编号&品牌名（fk）、状态
>
> 器材种类表（一类器材对应一个编号）：种类编号&品牌名（pk）、器材名、采购价、租金
>
> 若求数量，使用SQL：
>
> ```mysql
> select count(*) from 器材表 where 种类编号 = '羽毛球拍' and 品牌名 = ‘李宁’
> select count(*) from 器材表 where 种类编号 = '羽毛球拍' and 品牌名 = ‘李宁’ and 
> id != （select id from 订单表 where 当天被租用的器材） limit 0，器材数量
> ```





### 器材查询

权限：体育馆管理员

需要数据：器材类型、品牌名、采购价、租金

操作列：点击维护与点击恢复（“维护”与“可租用”的状态的互换）、点击报废、修改租金



查询流程：体育馆管理员根据实际情况，输入查询范围，然后系统展示查询结果，单个器材一行，每一行的最后一列是操作列，体育馆管理员可以根据需求进行操作。



### 器材租用

权限：学生

需要的数据：租用日期、租用时间、器材类型、器材品牌

操作列：点击租用  

注意，为保证公平，单个用户单次只能租用至多当天一整天时间的单个器材。



#### 器材租用订单状态

新增（新增租用申请，但未支付）

已支付（支付后但未到租用的时间段内）

执行中（当前正在租用的时间段内）

已结束（租用结束）

已过期（指新增订单后，仍未付款导致订单过期）

已退款（指支付后，开始租用之前，学生主动退款操作）

已取消（指处于“新增”和“已支付”状态时，体育馆管理员主动取消订单，若有付款会退款）



#### 租用流程

器材查询先选定时间，然后展示当天器材剩余情况，接着按情况选择租用。

> 已预约的订单保存在MySQL，分开存时间段（开始时间和结束时间）和日期



注意：一次只允许租用一个种类和品牌的器材。



租用完毕后，学生交还器材，体育馆管理员线下检查器材是否有损坏，然后在页面选择是否需要赔偿，若无损坏则点击“正常回收”；若有损坏，则点击“需要赔偿”，然后进入赔偿界面

若要赔偿：发邮件（包含赔偿支付链接，未支付不得任何操作，采购价赔偿）

若不需要赔偿：发邮件（学校已报修，无需赔偿）

需要数据：器材编号（可多个）





### 租用订单查询

权限：体育馆管理员

需要数据：租用日期、租用时间、器材类型、品牌名

操作列：取消订单（指的是处于“新增”和“已支付”→“已取消”，其他状态则不可取消订单）

前期数据库设计，待定

> 器材租用记录表（根据订单编号”分块“）：器材编号（pk）、种类编号&品牌名（fk）、订单编号
>
> 器材租用订单表：订单编号（pk）、学号、姓名、订单创建时间、订单状态







### 器材回收

流程触发：

1、学生租用器材后，交还器材时，由老师主动检查器材状态然后回收。

2、老师主动线下检查器材后，根据实际情况回收器材

3、学生租用后发现器材有损坏，提前交还器材告知老师，老师根据情况选择正常回收或异常回收

需要数据：

在进行的订单编号或者器材编号。（即学生交还器材和老师主动排查器材的两种情况）

操作列：正常回收、异常回收（体育馆管理员需要确定器材是否需要赔偿以及器材进入“维护”或“报废”状态）

如果需要赔偿：

若要赔偿：发邮件（包含赔偿支付链接，未支付不得任何操作，采购价赔偿）

若不需要赔偿：发邮件（学校已报修，无需赔偿）



回收分两种情况，正常回收和异常回收（若是提前回收，订单状态不变，到期自动变化）。异常回收还需要老师根据实际情况选择是否需要赔偿以及回收后器材的状态。







## 场地管理模块

### 单个场地状态

空闲、维护、使用中、报废（改建教学楼）

### 添加场地

权限：体育馆管理员

需要数据：图片、场地名称、场地类型、位置、详情描述

只允许手动添加单个场地

体育馆管理员主动上传添加场地



> 场地信息表：场地编号（pk，自增主键）、场地名称（unique）、场地类型（fk）、位置、详情描述
>
> 场地类型表：类型编号、类型名
>
> 示例：场地名称  篮球场01



### 删除场地

状态转变：→报废



### 场地预约

#### 场地租用订单状态

新增（新增租用申请，但未支付）

已支付（支付后但未到租用的时间段内）

执行中（当前正在租用的时间段内）

已结束（租用结束）

已过期（指新增订单后，仍未付款导致订单过期）

已退款（指支付后，开始租用之前的退款操作）

已候补（指进入候补状态的订单）

#### 场地租用候补订单

第一个人的订单状态变成已过期、已退款时，系统自动查询是否有候补订单，若有，则按先后顺序改变第一个人的订单状态



### 场地定期占用

体育馆管理员设置临时或长期某个时间的场地占用，若被占用则强制退款。

前端发回来日期、时间、场地后，后端先筛查定期占用表、再筛查场地租用订单表（表名字待定）



### 场地公告

用户点击公告，查看公告内容



## 赛事管理模块

### 赛事订单状态

新增（新增租用申请，还未给钱）

已支付（支付后但到租用的时间段内）

执行中（当前正在租用的时间段内）

已结束（租用结束）

已过期（指新增订单后，仍未付款导致订单过期）

已退款（指支付后，开始租用之前的退款操作）

（无候补状态）



### 赛事创建

权限：学生、体育馆管理员管理员

需要数据：赛事日期、赛事名称、所需的器材种类和数量、所需的场地种类和数量、赛事公告、主办人

产生的订单：对应时间段的器材和场地租用订单

说明：学生和体育馆管理员都可以创建，先创建，然后审核发布。若器材和场地的预约有冲突，由管理员做决定是否强制退款被预约的场地和器材。赛事创建要用到的器材和场地都需要交钱，统一自动创建前面的订单。主办人必须是数据库里面的用户

> 赛事表：赛事id（自增主键）、赛事名称、比赛开始时间和结束时间的两个时间戳、所需的器材种类和数量和时间（JSON）、所需的场地种类和数量和时间（JSON）、主办人（fk）赛事公告、赛事状态
>

前端页面展示：有一个日程添加，添加未来任意一天的场地和器材占用



### 赛事审核

权限：体育馆管理员

说明：所有新增的赛事申请都在这里统一审核，如果器材或场地产生冲突，则系统会提示是否解决冲突，如果确定需要验证码，系统会对冲突的器材和场地进行退款操作。**赛事审核其实也包括了查询历史订单的情况。**





## 业务报表模块









# 数据库设计

## 设计示例

表名 说明 表设计 建表语句 初始数据集

| 字段名 | comment | 数据类型 | 包含的Key | 是否允许NULL | 备注 |
| ------ | ------- | -------- | --------- | ------------ | ---- |
|        |         |          |           |              |      |
|        |         |          |           |              |      |

## 用户模块

## 器材模块

## 场地模块

## 赛事模块



# 系统约定

1、器材、场地可租用的时间段从早7点到晚10点，1小时/时间段，一共15个时间段。

2、场地、器材的租用按小时收费。





# 开发环境

## 前端



## 后端



